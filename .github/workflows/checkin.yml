name: Telegram Auto Sign

on:
  # 1. 定时触发
  schedule:
    # 语法：分 时 日 月 周
    # 注意：GitHub 使用 UTC 时间，比北京时间慢 8 小时
    # '0 1 * * *' 代表 UTC 1:00，即北京时间 9:00
    # 如果你想改成北京时间 8 点，就把下面的 1 改成 0
    - cron: '0 1 * * *'

  # 2. 手动触发 (允许你在 Actions 界面点击 Run workflow 按钮)
  workflow_dispatch:

jobs:
  run-checkin:
    runs-on: ubuntu-latest

    steps:
    # 第一步：拉取仓库代码
    - name: Checkout code
      uses: actions/checkout@v3

    # 第二步：安装 Python 环境 (使用 3.10 比较稳定)
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 第三步：安装 requirements.txt 里的依赖
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 第四步：运行主程序
    # 这里最关键：把 GitHub 后台的 Secrets 变成环境变量传给 Python
    - name: Run Sign Script
      env:
        TG_API_ID: ${{ secrets.TG_API_ID }}
        TG_API_HASH: ${{ secrets.TG_API_HASH }}
        TG_SESSION_STRING: ${{ secrets.TG_SESSION_STRING }}
        TG_CONFIG_JSON: ${{ secrets.TG_CONFIG_JSON }}
        TEST_MODE: ${{ secrets.TEST_MODE }}
      run: python -u main.py